第3章  ネットワーク
インストール後の設定作業として、ネットワーク環境を利用するために必要な設定を確認し、必要であれば再設定する。
確認のために、ネットワークインターフェースを調べるコマンドと、設定ファイルの変更やネットワーク設定スクリプトを利用する。
ネットワークを利用可能にする設定は、サーバ構築の前提条件となるため、必要不可欠な知識である。

■3-1.用語集
ネットワークインターフェース 
LAN ケーブルを接続して、外部のマシンとの間でデータをやり取りするための物理的なインターフェースである。

ループバックインターフェース 
マシン内部でデータをやり取りするための仮想的なインターフェースである。

IP(Internet Protocol) 
ネットワークに接続したコンピューター間でデータをやり取りするためのプロトコルである・

IP アドレス 
IP 通信で各コンピューターに割り当てられる値である。
データの送り先としてIPアドレスを指定すると、そのIPアドレスが割り当てられたコンピューターにデータが届く。

IPv4(Internet Protocol version 4) 
現在のインターネットで利用されている通信プロトコルである。
IPv4 では、IPアドレスを4 バイト（32 ビット）で表する。
本来は32個の2進数（0 と1）の羅列だが、
人間に分かりやすくするために1 バイトごとに10 進数に変換して
. (ドット) で区切って「192.168.1.1」のように表記する。
次世代のIP であるIPv6 では、IP アドレスを128 ビットで表する。

ネットワークアドレス 
ホストが属しているネットワーク自体を指し示すIP アドレスである。

ブロードキャストアドレス 
ホストが属しているネットワーク全体を指定する際に使用するIP アドレスである。

ネットマスク 
IP アドレスのうち、どこまでがネットワーク部で、どこまでがホスト部かを示すための値である。
IP アドレスとネットマスクの2つの値から、ネットワークアドレス、ブロードキャストアドレスを割り出せる。

デフォルトゲートウェイ 
インターネットは、小さなネットワークが相互に接続したネットワークである。
小さなネットワーク間を接続する機器としてルーター(ゲートウェイ) が使われる。
ゲートウェイは1つのネットワークに複数設置することができるが、
特に指定が無い場合にはデフォルトゲートウェイを使って外部のネットワークとの通信を行う。

DHCP(Dynamic Host Configuration Protocol) 
IP アドレスなどのネットワーク設定を自動的に割り当てるプロトコルである。

TCP(Transmission Control Protocol) 
コネクション方式で通信するプロトコルである。
IPと組み合わせたTCP/IP がインターネットの標準的な通信プロトコルである。
TCPの特長として、届かなかった通信パケットを再送信して確実に通信を行う仕組みがある。

UDP(User Datagram Protocol) 
コネクションレス方式で通信するプロトコルである。
TCPとは異なり、データの再送信が行われないので通信の確実性は劣るが、セッションを確立するための「3ウェイハンドシェイク」の手間が不要なためシンプルな通信に適する。
たとえば、大量に問い合わせが行われるDNS への名前解決の問い合わせはUDP となっています。

ポート番号 
TCPとUDP が通信する際に使用する値である。
たとえばWebサーバはポート番号80番を使用して動作しているので、Webブラウザは目的のWebサーバーのポート番号80番に接続する。
ポート番号は0番から65535番まで使用できるが0～1023番はWELLKNOWN PORT、1024～49151番はREGISTERED PORTとして予約されている。

ICMP(Internet Control Message Protocol) 
データの転送エラーやデータ転送量などの情報を通知するためのプロトコルである。

ping コマンド 
ICMP を使って宛先として指定したホストに到達できるかを確認するコマンドである。

■3-2. NetworkManager
現在サポートされているLinuxでは、複数のネットワークインターフェースを含むすべてのネットワーク機能を自動的に検出管理するNetworkManagerが導入されている。

3-2-1.NetworkManagerを使ったネットワークの設定例
Rocky Linux9ではNetworkManagerの利用が推奨され、nmcli/nmtui コマンドにより設定を管理できる。 
nmcliコマンドの形式は下記の通り

nmcli [Option] [制御コマンド { gen(eral) | net(working) | con(nection) | dev(ice) } [パラメータ] 


nmcliコマンドの例）
nmcli con show   ← 全接続状態の表示 
nmcli dev disconnect iface eth0   ← デバイスの切断 
nmcli con mod ens160 ipv4.address “192.168.41.219” ← IPアドレスを「192.168.41.219」に変更する

なお、nmtuiはテキスト形式のGUIメニューで操作できるより簡単なインターフェースである。
nmcli、nmtui共にNetworkManagerが有効でないと実行できない。

■3-3.ネットワークの確認
Linuxをインストールしたマシンが正常にネットワークに接続できるかどうか、設定を確認する。

3-3-1. ネットワークインターフェースの確認
インストール時に設定したネットワークインターフェースの状態を確認する。

コマンド：
ip a show

結果：
1: lo:
 ・・・~省略
2: ens32
 ・・・~省略

lo が仮想的なループバックインターフェース、ens から始まるものが物理的なインターフェースである。

3-3-2. ネットワークインターフェースの設定の確認
ネットワークインターフェースens○○（○○については3-3-1で表示された値です）の設定を参照する。

コマンド：
nmcli con show ens○○（←3-3-1で表示された値）

connection.id:                          
ens32 
connection.uuid:                        
ae743c67-a184-366d-be2c-a7676f1a232e 
connection.stable-id:                   -- 
connection.type:                        
802-3-ethernet 
connection.interface-name:              
ens32 
connection.autoconnect:                 
yes 
（略） 
ipv4.method:                            
manual 
ipv4.dns:                               
192.168.41.66 
ipv4.dns-search:                        -- 
ipv4.dns-options:                       -- 
ipv4.dns-priority:                      
0 
ipv4.addresses:                         
192.168.41.66/24 
ipv4.gateway:                           
192.168.41.1 
ipv4.routes:                            -- 
（略） 

lo の設定はどのマシンでも同じ内容となりますが、ens〇〇の設定はマシン毎に異なる。
上記のコマンドを実行すると、設定する項目名と設定内容が「：」で対応づけされた形 (「カテゴリ.項目名: 設定内容」という記述) で一覧表示される。
主な設定項目と内容は次の表のとおり。

3-3-3. IPv6の無効化
省略

3-3-4. ネットワークインターフェースの動作確認 
